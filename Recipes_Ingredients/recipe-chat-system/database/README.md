# Database Setup Instructions

## Overview
This directory contains all the SQL scripts needed to initialize the recipe database with:
- Recipe data with embeddings
- Ingredient canonical names and variants  
- Tags and tag groups
- User management tables
- Test user accounts

## File Structure
```
database/
├── 00_init_db.sh           # Orchestrates initialization (runs automatically)
├── 01_schema.sql           # Creates all tables and indexes
├── 03_recipes_data.sql     # Recipe data (generated by export script)
├── 04_ingredients_data.sql # Ingredients and variants
├── 05_tags_data.sql        # Tags and groups
├── 06_test_users.sql       # Test users for demo
└── README.md               # This file
```

## Initial Setup (One-time Export)

This is only to produce scripts - dont use it . You can start from the next step:

```bash
# From project root
python scripts/export_existing_data.py
```

This will create the SQL data files in the `database/` directory.

## Automatic Initialization

When you run `docker-compose up`, PostgreSQL will:

1. Create all tables with proper schemas
2. Load recipe data with embeddings
3. Import ingredient mappings (tomato → tomatoes, etc.)
4. Load tags and categories
5. Create test users

## Test Users

The following test accounts are created automatically:
- Email: `test@example.com`, Password: `password`
- Email: `demo@example.com`, Password: `password`

## Verification

To verify the data loaded correctly:

```bash
# Connect to the database
docker exec -it recipe_postgres psql -U postgres -d recipes_db

# Check data counts
SELECT 
    (SELECT COUNT(*) FROM recipes) as recipes,
    (SELECT COUNT(*) FROM ingredients) as ingredients,
    (SELECT COUNT(*) FROM tags) as tags,
    (SELECT COUNT(*) FROM users) as users;
```

## Troubleshooting

If data doesn't load:
1. Check Docker logs: `docker-compose logs postgres`
2. Ensure SQL files are present in `database/` directory
3. Files must be readable by the postgres user in container

## Re-initializing Database

To completely reset the database:

```bash
# Stop containers and remove volumes
docker-compose down -v

# Start fresh
docker-compose up
```